<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- 可选的Bootstrap主题文件（一般不使用） -->
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"></script>

    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <link href="navbar.css" rel="stylesheet">
    <meta charset="utf-8"/>
    <title>用户信息</title>
</head>
<body>
<div class="container">
    <div th:replace="comm/header::pagination(active=${active},user=${session.user})"></div>

    <div class="jumbotron">
        <form class="form-horizontal" id="messageForm" role="form">
            <fieldset>
                <legend>基本信息</legend>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="ds_host">用户名</label>
                    <div class="col-sm-4">
                        <input class="form-control" id="ds_host" type="text" th:value="${session.user.username}"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="ds_username">基本信息</label>
                    <div class="col-sm-10">
                        <textarea class="form-control" id="ds_username" type="text" rows="3"
                                  th:value="${session.user.info}"></textarea>
                    </div>
                </div>
            </fieldset>
            <fieldset>
                <legend>修改密码</legend>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="ds_host1">原密码</label>
                    <div class="col-sm-4">
                        <input class="form-control" id="ds_host1" type="text" placeholder="请输入原密码"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="ds_host2">新密码</label>
                    <div class="col-sm-4">
                        <input class="form-control" id="ds_host2" type="text" placeholder="请输入新密码"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="ds_host3">新密码</label>
                    <div class="col-sm-4">
                        <input class="form-control" id="ds_host3" type="text" placeholder="确认新密码"/>
                    </div>
                </div>
            </fieldset>
            <center>
                <button class="btn btn-lg btn-primary" style="width: 20%;" type="submit">
                    <span>提交</span>
                </button>
            </center>
        </form>
    </div>
</div>

<script type="text/javascript" th:src="@{/static/plugins/jquery/3.2.1/jquery-3.2.1.js}"></script>
<script type="text/javascript" th:src="@{/static/plugins/limonte-sweetalert2/6.4.1/sweetalert2.min.js}"></script>
<script type="text/javascript" th:src="@{/static/js/base.js}"></script>
<script type="text/javascript">
    var tale = new $.tale();

    function submitForm() {
        var oldPassword = $.trim($("#ds_host1").val());
        var newPassword1 = $.trim($("#ds_host2").val());
        var newPassword2 = $.trim($("#ds_host3").val());
        if (newPassword2 == '' && newPassword1 == '') {
            if (oldPassword != '') {
                tale.alertError("请输入新密码");
            }
        } else {
            if (oldPassword == '') {
                tale.alertError("请输入原密码");
            }
            if (newPassword1 != newPassword2) {
                tale.alertError("两次输入的密码不一致");
            }
        }

        if(oldPassword != ''){
            checkOldPassword(oldPassword);
        }

        tale.post({
            url: '/user/modify_userMsg',
            data: $("#messageForm").serialize(),
            success: function (result) {
                if (result && result.success) {
                    tale.alertOk("修改成功");
                } else {
                    tale.alertError(result.msg || '修改失败,稍后再试');
                }
            }
        });
        return false;
    }

    function checkOldPassword(password) {
        tale.post({
            url:'/user/check_password',
            data:password,
            success:function (result) {
                if (result && result.success) {
                } else {
                    tale.alertError(result.msg || '旧密码输入错误');
                }
            }
        });
        return false;
    }
</script>
</body>
</html>